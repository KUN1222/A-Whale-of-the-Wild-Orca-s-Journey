<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Whale of the Wild - Family Tree</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        :root {
            --bg-dark: #0a192f;
            --bg-node: #112240;
            --border-line: #233554;
            --text-light: #ccd6f6;
            --text-medium: #8892b0;
            --text-accent: #64ffda;
            --text-selection: #f5a623;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            padding: 2rem;
            overflow-x: hidden;
        }
        .tree-wrapper {
            display: flex;
            justify-content: center;
            overflow-x: auto;
            padding: 2rem 0;
        }
        .tree ul, .tree li { position: relative; margin: 0; padding: 0; list-style-type: none; }
        .tree ul { display: flex; padding-top: 70px; }
        .tree li { display: flex; flex-direction: column; align-items: center; padding: 0 10px; }
        .node {
            padding: 12px 24px;
            background-color: var(--bg-node);
            border: 2px solid var(--border-line);
            border-radius: 6px;
            font-weight: 500;
            text-align: center;
            min-width: 140px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .node-icon { font-size: 1.5rem; line-height: 1; }
        .node:hover { transform: translateY(-3px); border-color: var(--text-accent); }
        .node.is-vega { color: var(--text-accent); border-color: var(--text-accent); }
        .node.is-lost { color: var(--text-medium); text-decoration: line-through; opacity: 0.7; }
        .node.selected {
            border-color: var(--text-selection);
            box-shadow: 0 0 20px rgba(245, 166, 35, 0.5);
            transform: translateY(-3px);
        }
        .tree li::before {
            content: ''; position: absolute; top: -35px; left: 50%;
            transform: translateX(-50%); width: 2px; height: 35px; background-color: var(--border-line);
        }
        .tree li::after {
            content: ''; position: absolute; top: -35px; height: 2px;
            background-color: var(--border-line); width: 100%;
        }
        .tree > li::before, .tree > li::after { display: none; }
        .tree ul li:only-child::after { display: none; }
        .tree ul li:first-child::after { left: 50%; width: 50%; }
        .tree ul li:last-child::after { left: 0; width: 50%; }
        .relationship-label {
            position: absolute; top: -55px; left: 50%;
            transform: translateX(-50%); font-size: 0.75rem; color: var(--text-medium);
            background-color: var(--bg-dark); padding: 0 5px; white-space: nowrap;
        }
        .section-title {
            text-align: center; font-size: 1.5rem; font-weight: 700; color: var(--text-accent);
            margin-top: 4rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border-line);
        }
        #character-tooltip, .banner-container {
            position: fixed; z-index: 100;
            transition: opacity 0.3s, transform 0.3s;
        }
        #character-tooltip {
            background-color: var(--bg-node); border: 1px solid var(--text-accent);
            border-radius: 8px; width: 300px; padding: 1.25rem;
            opacity: 0; visibility: hidden; pointer-events: none;
            transform: scale(0.95);
        }
        #character-tooltip.visible {
            opacity: 1; visibility: visible; transform: scale(1);
        }
        .tooltip-icon { font-size: 2.5rem; float: left; margin-right: 1rem; }
        .banner-container {
            top: 2rem; left: 0; width: 100%; display: none;
            align-items: flex-start; justify-content: center; pointer-events: none;
        }
        .banner {
            background-color: var(--bg-node); padding: 1rem 1.5rem; border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); font-weight: 500;
            display: flex; align-items: center; gap: 1rem; pointer-events: auto;
            max-width: 90%; color: var(--text-selection);
            border: 1px solid var(--text-selection);
        }
        .close-banner {
            font-size: 1.5rem; line-height: 1; cursor: pointer; color: var(--text-medium);
            transition: color 0.2s;
        }
        .close-banner:hover { color: var(--text-light); }
    </style>
</head>
<body>
    <header class="text-center mb-4">
        <h1 class="text-3xl md:text-5xl font-bold">The Whale of the Wild</h1>
        <p class="text-lg text-cyan-400">æ ¸å¿ƒå®¶æ—å…³ç³»å›¾</p>
    </header>

    <div id="tree-container" class="tree-wrapper">
        <!-- JS generates main tree here -->
    </div>
    
    <div id="other-kinship-container">
        <h2 class="section-title">åŒæ—å…¶ä»–æˆå‘˜</h2>
        <div class="tree-wrapper">
             <!-- JS generates other kinship trees here -->
        </div>
    </div>

    <!-- Tooltip HTML -->
    <div id="character-tooltip"></div>
    
    <!-- Banner HTML -->
    <div id="banner-display" class="banner-container">
        <div id="banner-content" class="banner">
            <span id="banner-text" class="text-lg"></span>
            <span id="close-banner" class="close-banner">&times;</span>
        </div>
    </div>

    <script>
        const characterData = {
            siria: { name: 'Greatmother Siria', icon: 'ğŸ‘µğŸ»', title: 'æ™ºæ…§çš„å¥³æ—é•¿', gender: 'F', generation: 1, parent: null, story: 'å®¶æ—çš„æœ€é«˜é¢†è¢–ä¸é¦–å¸­å¯»è·¯è€…ã€‚å¥¹æ˜¯æ•´ä¸ªé²¸ç¾¤çš„æ™ºæ…§æ ¸å¿ƒä¸å†å²çš„æ´»å­—å…¸ã€‚å¥¹çš„æ•™è¯²ï¼Œå¦‚â€œç¾æ˜¯æ€æƒ³çš„é£Ÿç²®â€ï¼Œåœ¨ç»´åŠ æœ€è¿·èŒ«çš„æ—¶å€™ç»™äºˆäº†å…³é”®æŒ‡å¼•ã€‚' },
            arctura: { name: 'Mother Arctura', icon: 'ğŸ‘©ğŸ»', title: 'æ…ˆçˆ±çš„çŒæ‰‹', gender: 'F', generation: 2, parent: 'siria', story: 'ç»´åŠ å’Œå¾·å†…ä¼¯çš„æ¯äº²ï¼Œä¸€ä½å¼ºå¤§çš„çŒæ‰‹ã€‚å¥¹åœ¨æ‰¿å—ä¸§å¥³ä¹‹ç—›çš„åŒæ—¶ï¼Œä¾ç„¶æ˜¯å­©å­ä»¬å¿ƒä¸­æ¸©æš–å’ŒåŠ›é‡çš„æ¥æºã€‚' },
            nova: { name: 'Aunt Nova', icon: 'ğŸ‘©ğŸ»', title: 'æ”¯æŒçš„å§å¦¹', gender: 'F', generation: 2, parent: 'siria', story: 'é˜¿å…‹å›¾æ‹‰çš„å§å¦¹ï¼Œé˜¿å¥æ‹‰çš„æ¯äº²ã€‚å¥¹åœ¨å®¶æ—ä¸­æ‰®æ¼”ç€é‡è¦çš„æƒ…æ„Ÿæ”¯æŒè§’è‰²ï¼Œä½“ç°äº†æ¯ç³»ç¤¾ä¼šä¸­å§å¦¹é—´çš„ç´§å¯†è”ç³»ã€‚' },
            andromeda: { name: 'Andromeda', icon: 'ğŸ‘§ğŸ»', title: 'å¤±è½çš„äº²äºº', isLost: true, gender: 'F', generation: 2, parent: 'siria', story: 'é˜¿å…‹å›¾æ‹‰å’Œè¯ºå¨ƒæœ€å°çš„å¦¹å¦¹ï¼Œåœ¨å¤šå¹´å‰çš„â€œæ•çŒå­£â€è¢«äººç±»æŠ“èµ°ï¼Œå¥¹çš„å¤±è¸ªæ˜¯å®¶æ—å¿ƒä¸­æ°¸è¿œçš„ç—›ã€‚' },
            rigel: { name: 'Great-uncle Rigel', icon: 'ğŸ‘¨ğŸ»â€ğŸ¦³', title: 'åšå®šçš„å®ˆæŠ¤è€…', gender: 'M', generation: 1.5, parent: 'siria', isSibling: true, story: 'å¸Œè‰äºšçš„å¼Ÿå¼Ÿï¼Œå®¶æ—çš„å®ˆæŠ¤ç¥ã€‚ä»–æ²‰é»˜å¯¡è¨€ä½†è¡ŒåŠ¨å……æ»¡åŠ›é‡ï¼ŒèƒŒä¸Šçš„ä¼¤ç–¤è§è¯äº†ä»–ä¸ºä¿æŠ¤å®¶æ—è€Œæˆ˜çš„è‹±å‹‡è¿‡å»ã€‚' },
            antares: { name: 'Great-uncle Antares', icon: 'ğŸ‘¨ğŸ»â€ğŸ¦³', title: 'è­¦æƒ•çš„å®ˆæŠ¤è€…', gender: 'M', generation: 1.5, parent: 'siria', isSibling: true, story: 'ä¸å‚å®¿ä¸ƒä¸€åŒè¡ŒåŠ¨çš„å®ˆæŠ¤è€…ï¼Œå¾ˆå¯èƒ½æ˜¯å¸Œè‰äºšè€ç¥–æ¯çš„å¦ä¸€ä½å…„å¼Ÿã€‚ä»–åœ¨å®¶æ—éœ€è¦ä¿æŠ¤çš„å…³é”®æ—¶åˆ»æ€»æ˜¯æŒºèº«è€Œå‡ºã€‚' },
            vega: { name: 'Vega', icon: 'ğŸ‘§ğŸ»', title: 'æˆé•¿ä¸­çš„å¯»è·¯è€…', isProtagonist: true, gender: 'F', generation: 3, parent: 'arctura', story: 'æ•…äº‹çš„ä¸»è§’ã€‚åœ¨ç»å†å¤±å»å¦¹å¦¹ã€ä¸å®¶æ—å¤±æ•£çš„é‡é‡è€ƒéªŒåï¼Œå¥¹ä»ä¸€ä¸ªå†²åŠ¨ã€è¿·èŒ«çš„å¹´è½»è™é²¸ï¼Œæˆé•¿ä¸ºä¸€åå‹‡æ•¢ã€æœ‰æ‹…å½“çš„çœŸæ­£é¢†è¢–ã€‚' },
            deneb: { name: 'Deneb', icon: 'ğŸ‘¦ğŸ»', title: 'å¿ è¯šçš„è¿½éšè€…', gender: 'M', generation: 3, parent: 'arctura', story: 'ç»´åŠ çš„å¼Ÿå¼Ÿã€‚ä»–å¯¹å§å§æ€€æœ‰ç»å¯¹çš„ä¿¡ä»»ï¼Œæ˜¯ç»´åŠ åŠ›é‡çš„é‡è¦æ¥æºã€‚ä»–åœ¨æ—…é€”ä¸­ä»ä¸€ä¸ªéœ€è¦è¢«ä¿æŠ¤çš„å­©å­ï¼Œæˆé•¿ä¸ºä¸€ä¸ªå‹‡æ•¢çš„å°‘å¹´ã€‚' },
            aquila: { name: 'Aquila', icon: 'ğŸ‘©ğŸ»', title: 'åšå¼ºçš„æ¯äº²', gender: 'F', generation: 3, parent: 'nova', story: 'ç»´åŠ çš„è¡¨å§ã€‚å¥¹ä»ä¸€ä¸ªå¤„å¤„è¡¨ç°ä¼˜è¶Šçš„â€œæ¨¡èŒƒç”Ÿâ€ï¼Œåœ¨ç¾éš¾å’Œé¥¥é¥¿çš„æ‰“å‡»ä¸‹ï¼Œèœ•å˜ä¸ºä¸€ä¸ªä¸ºäº†å­©å­å¯ä»¥æ”¾å¼ƒä¸€åˆ‡çš„æ¯äº²ã€‚' },
            capella: { name: 'Capella', icon: 'ğŸ–¤', title: 'é™¨è½çš„å¸Œæœ›', isLost: true, gender: 'F', generation: 3, parent: 'arctura', story: 'ç»´åŠ æœªæ›¾è°‹é¢çš„å¦¹å¦¹ï¼Œå‡ºç”Ÿå³å¤­æŠ˜ã€‚å¥¹çš„æ­»äº¡æ˜¯ç»´åŠ ç¦»å®¶å’Œæœ€ç»ˆæˆé•¿çš„ç›´æ¥åŸå› ã€‚' },
            altair: { name: 'Altair', icon: 'ğŸ‘¦ğŸ»', title: 'å¤©çœŸçš„å¹¼é²¸', gender: 'M', generation: 4, parent: 'aquila', story: 'é˜¿å¥æ‹‰çš„å¹¼å­ï¼Œä»£è¡¨äº†é²¸ç¾¤çš„æœªæ¥ä¸å¸Œæœ›ã€‚åœ¨è‰°éš¾çš„æ—…é€”ä¸­ï¼Œä»–çš„å­˜åœ¨æ˜¯å¤§å®¶ç»§ç»­å‰è¡Œçš„åŠ¨åŠ›ä¹‹ä¸€ã€‚' },
            io: { name: 'Io (Ancestor)', icon: 'ğŸ“œ', title: 'å…ˆç¥–', story: 'â€œæš–æ°´é£Ÿé²‘ç¤¾ç¾¤â€çš„ä¸€ä½ç¥–å…ˆï¼Œåœ¨â€œå¤§é›†ä¼šâ€æ—¶è¢«æåŠï¼Œæ˜¯ Ganymede çš„æ›¾ç¥–æ¯ã€‚' },
            europa: { name: 'Europa', icon: 'ğŸ‘©ğŸ»', title: 'åŒæ—æˆå‘˜', story: 'Io çš„åä»£ï¼ŒGanymede çš„æ¯äº²ï¼Œå±äºåºå¤§çš„â€œæš–æ°´é£Ÿé²‘ç¤¾ç¾¤â€ã€‚' },
            ganymede: { name: 'Ganymede', icon: 'ğŸ‘§ğŸ»', title: 'åŒæ—æˆå‘˜', story: 'Europa çš„å¥³å„¿ï¼Œåœ¨â€œå¤§é›†ä¼šâ€æ—¶å‘å¤§å®¶å®£å‘Šè‡ªå·±çš„åå­—å’Œè¡€ç»Ÿã€‚' },
            titania: { name: 'Titania (Ancestor)', icon: 'ğŸ“œ', title: 'å…ˆç¥–', story: 'â€œæš–æ°´é£Ÿé²‘ç¤¾ç¾¤â€çš„å¦ä¸€ä½ç¥–å…ˆï¼Œæ˜¯ Mimas çš„æ›¾ç¥–æ¯ã€‚' },
            phoebe: { name: 'Phoebe', icon: 'ğŸ‘©ğŸ»', title: 'åŒæ—æˆå‘˜', story: 'Titania çš„å¥³å„¿ï¼ŒMimas çš„æ¯äº²ã€‚' },
            mimas: { name: 'Mimas', icon: 'ğŸ‘¦ğŸ»', title: 'åŒæ—æˆå‘˜', story: 'Phoebe çš„å„¿å­ï¼Œåœ¨â€œå¤§é›†ä¼šâ€æ—¶å®£å‘Šè‡ªå·±çš„åå­—ã€‚' }
        };

        function createNode(id) {
            const char = characterData[id];
            const node = document.createElement('div');
            node.className = 'node';
            node.dataset.id = id;
            if (char.isProtagonist) node.classList.add('is-vega');
            if (char.isLost) node.classList.add('is-lost');
            const iconSpan = document.createElement('span');
            iconSpan.className = 'node-icon';
            iconSpan.textContent = char.icon;
            const nameSpan = document.createElement('span');
            nameSpan.textContent = char.name;
            node.appendChild(iconSpan);
            node.appendChild(nameSpan);
            return node;
        }

        function createTreeHTML(structure) {
            const li = document.createElement('li');
            if (structure.label) {
                const label = document.createElement('span');
                label.className = 'relationship-label';
                label.textContent = structure.label;
                li.appendChild(label);
            }
            li.appendChild(createNode(structure.id));
            if (structure.children && structure.children.length > 0) {
                const ul = document.createElement('ul');
                structure.children.forEach(child => ul.appendChild(createTreeHTML(child)));
                li.appendChild(ul);
            }
            return li;
        }

        const mainFamilyTreeStructure = {
            id: 'siria',
            children: [
                { id: 'arctura', label: 'å¥³å„¿', children: [
                    { id: 'vega', label: 'å¥³å„¿' }, { id: 'deneb', label: 'å„¿å­' }, { id: 'capella', label: 'å¥³å„¿' }
                ]},
                { id: 'nova', label: 'å¥³å„¿', children: [
                    { id: 'aquila', label: 'å¥³å„¿', children: [ { id: 'altair', label: 'å„¿å­' } ]}
                ]},
                { id: 'andromeda', label: 'å¥³å„¿' },
                { id: 'rigel', label: 'å¼Ÿå¼Ÿ' },
                { id: 'antares', label: 'å¼Ÿå¼Ÿ' }
            ]
        };
        const mainTreeUl = document.createElement('ul');
        mainTreeUl.className = 'tree';
        mainTreeUl.appendChild(createTreeHTML(mainFamilyTreeStructure));
        document.getElementById('tree-container').appendChild(mainTreeUl);
        
        const otherKinshipContainer = document.querySelector('#other-kinship-container .tree-wrapper');
        const ioTree = createTreeHTML({ id: 'io', children: [{ id: 'europa', label: 'åä»£', children: [{ id: 'ganymede', label: 'å¥³å„¿' }] }] });
        const titaniaTree = createTreeHTML({ id: 'titania', children: [{ id: 'phoebe', label: 'å¥³å„¿', children: [{ id: 'mimas', label: 'å„¿å­' }] }] });
        const ioTreeUl = document.createElement('ul');
        ioTreeUl.className = 'tree';
        ioTreeUl.appendChild(ioTree);
        const titaniaTreeUl = document.createElement('ul');
        titaniaTreeUl.className = 'tree ml-16';
        titaniaTreeUl.appendChild(titaniaTree);
        otherKinshipContainer.append(ioTreeUl, titaniaTreeUl);

        const tooltip = document.getElementById('character-tooltip');
        const bannerDisplay = document.getElementById('banner-display');
        const bannerText = document.getElementById('banner-text');
        const closeBannerBtn = document.getElementById('close-banner');
        
        let selectedCharacters = [];
        let bannerTimeout;

        document.querySelectorAll('.node').forEach(node => {
            node.addEventListener('mouseenter', (e) => {
                const id = node.dataset.id;
                const char = characterData[id];
                tooltip.innerHTML = `
                    <div class="tooltip-icon">${char.icon}</div>
                    <div>
                        <h3 class="text-lg font-bold ${char.isProtagonist ? 'text-cyan-400' : ''}">${char.name}</h3>
                        <p class="text-sm text-gray-400 mb-2">${char.title}</p>
                        <p class="text-xs">${char.story}</p>
                    </div>
                `;
                const rect = node.getBoundingClientRect();
                const tooltipWidth = 300;
                tooltip.style.left = `${rect.left + rect.width / 2 - tooltipWidth / 2}px`;
                tooltip.style.top = `${rect.bottom + 10}px`;
                tooltip.classList.add('visible');
            });
            node.addEventListener('mouseleave', () => {
                tooltip.classList.remove('visible');
            });

            node.addEventListener('click', (e) => {
                const id = node.dataset.id;
                
                // If two characters are already selected, a new click on any node resets everything and starts a new selection.
                if (selectedCharacters.length >= 2) {
                    hideBannerAndReset();
                }

                const isSelected = selectedCharacters.includes(id);

                if (isSelected) {
                    // Deselect if clicking an already selected node.
                    selectedCharacters = selectedCharacters.filter(selectedId => selectedId !== id);
                    node.classList.remove('selected');
                } else {
                    // Select the new node.
                    selectedCharacters.push(id);
                    node.classList.add('selected');
                }

                // If two nodes are now selected, show the relationship.
                if (selectedCharacters.length === 2) {
                    const relation = findRelationship(selectedCharacters[0], selectedCharacters[1]);
                    showBanner(relation);
                }
            });
        });
        
        function showBanner(relation) {
            bannerText.textContent = relation;
            bannerDisplay.style.display = 'flex';
            // Timeout removed to make the banner and selection persistent.
            // clearTimeout(bannerTimeout);
            // bannerTimeout = setTimeout(hideBannerAndReset, 5000); 
        }

        function hideBannerAndReset() {
            bannerDisplay.style.display = 'none';
            resetSelection();
        }

        function resetSelection() {
            selectedCharacters = [];
            document.querySelectorAll('.node.selected').forEach(n => n.classList.remove('selected'));
        }
        
        function findRelationship(id1, id2) {
            if (id1 === id2) return "è¿™æ˜¯åŒä¸€ä¸ªäººã€‚";
            const char1 = characterData[id1]; 
            const char2 = characterData[id2];
            let relation = `ä»–ä»¬æ˜¯è¿œäº²ã€‚`;

            if (char1.parent === id2) relation = `${char2.name} æ˜¯ ${char1.name} çš„æ¯äº²ã€‚`;
            else if (char2.parent === id1) relation = `${char1.name} æ˜¯ ${char2.name} çš„${char2.gender === 'F' ? 'æ¯äº²' : 'çˆ¶äº²'}ã€‚`;
            else if (char1.parent === char2.parent && char1.parent) {
                 if(char1.gender === 'F' && char2.gender === 'F') relation = `${char1.name} å’Œ ${char2.name} æ˜¯å§å¦¹ã€‚`;
                 else if(char1.gender === 'M' && char2.gender === 'M') relation = `${char1.name} å’Œ ${char2.name} æ˜¯å…„å¼Ÿã€‚`;
                 else relation = `${char1.name} å’Œ ${char2.name} æ˜¯å…„å¦¹/å§å¼Ÿã€‚`;
            } else if ((char1.isSibling && char2.generation >= 3) || (char2.isSibling && char1.generation >= 3)) {
                const grandNiece = char1.generation >= 3 ? char1 : char2;
                const greatUncle = char1.isSibling ? char1 : char2;
                relation = `${greatUncle.name} æ˜¯ ${grandNiece.name} çš„èˆ…å…¬ã€‚`;
            } else {
                 const getPathToRoot = id => {
                    const path = []; let current = characterData[id];
                    while(current) { path.push(id); id = current.isSibling ? null : current.parent; current = characterData[id]; }
                    return path;
                };
                const path1 = getPathToRoot(id1); const path2 = getPathToRoot(id2);
                const lca = path1.find(id => path2.includes(id));
                if (lca) {
                    const lcaNode = characterData[lca];
                    if (lca === id2) relation = `${char2.name} æ˜¯ ${char1.name} çš„${char1.generation - lcaNode.generation === 1 ? 'æ¯äº²' : 'å¤–ç¥–æ¯'}ã€‚`;
                    else if (lca === id1) relation = `${char1.name} æ˜¯ ${char2.name} çš„${char2.generation - lcaNode.generation === 1 ? 'æ¯äº²' : 'å¤–ç¥–æ¯'}ã€‚`;
                    else if(characterData[char1.parent]?.parent === characterData[char2.parent]?.parent) relation = `${char1.name} å’Œ ${char2.name} æ˜¯è¡¨å§å¦¹/å…„å¼Ÿã€‚`;
                    else if(characterData[char1.parent] === characterData[char2.parent]?.parent) relation = `${char2.name} æ˜¯ ${char1.name} çš„å§¨å¦ˆã€‚`;
                    else if(characterData[char2.parent] === characterData[char1.parent]?.parent) relation = `${char1.name} æ˜¯ ${char2.name} çš„å§¨å¦ˆã€‚`;
                }
            }
            return relation;
        }
        closeBannerBtn.addEventListener('click', hideBannerAndReset);
    </script>
</body>
</html>

